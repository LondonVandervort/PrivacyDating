<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Connection Test</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; margin: 10px; }
        button:hover { background: #0056b3; }
        .message { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .loading { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>🔧 Private Dating Platform - Connection Test</h1>

    <div id="status">
        <p><strong>Contract Address:</strong> 0x42955a0528bc9e91a812a603d3dd4d2c48455b45</p>
        <p><strong>Network:</strong> Sepolia Testnet</p>
    </div>

    <div id="walletSection">
        <button id="connectWallet">Connect Wallet</button>
        <button id="checkEthers">Check Ethers Library</button>
        <button id="checkMetaMask">Check MetaMask</button>
        <button id="testContract">Test Contract Connection</button>
    </div>

    <div id="messages"></div>

    <script>
        const CONTRACT_ADDRESS = "0x42955a0528bc9e91a812a603d3dd4d2c48455b45";
        const CONTRACT_ABI = [
            "function owner() external view returns (address)",
            "function userCount() external view returns (uint256)",
            "function matchCount() external view returns (uint256)"
        ];

        let provider, signer, contract, userAddress;

        function log(message, type = 'info') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('messages').appendChild(div);
        }

        // Check Ethers
        document.getElementById('checkEthers').addEventListener('click', function() {
            if (typeof ethers !== 'undefined') {
                log('✅ Ethers.js library loaded successfully', 'success');
                log(`Ethers version: ${ethers.version}`, 'info');
            } else {
                log('❌ Ethers.js library not loaded', 'error');
            }
        });

        // Check MetaMask
        document.getElementById('checkMetaMask').addEventListener('click', function() {
            if (typeof window.ethereum !== 'undefined') {
                log('✅ MetaMask detected', 'success');
                log(`Provider: ${window.ethereum.isMetaMask ? 'MetaMask' : 'Unknown'}`, 'info');
            } else {
                log('❌ MetaMask not found', 'error');
            }
        });

        // Connect Wallet
        document.getElementById('connectWallet').addEventListener('click', async function() {
            log('🔄 Attempting wallet connection...', 'loading');

            try {
                if (typeof ethers === 'undefined') {
                    log('❌ Ethers library not loaded', 'error');
                    return;
                }

                if (typeof window.ethereum === 'undefined') {
                    log('❌ MetaMask not found', 'error');
                    return;
                }

                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length === 0) {
                    log('❌ No accounts found', 'error');
                    return;
                }

                // Create provider and signer
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = accounts[0];

                log(`✅ Wallet connected: ${userAddress}`, 'success');

                // Get network info
                const network = await provider.getNetwork();
                log(`📡 Network: ${network.name} (Chain ID: ${network.chainId})`, 'info');

                // Get balance
                const balance = await provider.getBalance(userAddress);
                log(`💰 Balance: ${ethers.utils.formatEther(balance)} ETH`, 'info');

            } catch (error) {
                log(`❌ Wallet connection failed: ${error.message}`, 'error');
            }
        });

        // Test Contract
        document.getElementById('testContract').addEventListener('click', async function() {
            if (!provider) {
                log('❌ Please connect wallet first', 'error');
                return;
            }

            log('🔄 Testing contract connection...', 'loading');

            try {
                // Create contract instance
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);

                // Test contract calls
                const owner = await contract.owner();
                log(`✅ Contract Owner: ${owner}`, 'success');

                const userCount = await contract.userCount();
                log(`👥 Total Users: ${userCount.toString()}`, 'success');

                const matchCount = await contract.matchCount();
                log(`💕 Total Matches: ${matchCount.toString()}`, 'success');

                // Check contract code
                const code = await provider.getCode(CONTRACT_ADDRESS);
                if (code === '0x') {
                    log('❌ No contract deployed at this address', 'error');
                } else {
                    log(`✅ Contract deployed, code length: ${code.length}`, 'success');
                }

            } catch (error) {
                log(`❌ Contract test failed: ${error.message}`, 'error');
                console.error('Contract error:', error);
            }
        });

        // Auto-run checks on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('checkEthers').click();
                document.getElementById('checkMetaMask').click();
            }, 1000);
        });
    </script>
</body>
</html>